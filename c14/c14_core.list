     1                                           ;?????çÀ14-1
     2                                           ;???????c14_core.asm
     3                                           ;??????????????????????? 
     4                                           ;?????????2011-11-6 18:37
     5                                  
     6                                           ;??????????ø˘???????????????????? 
     7                                           core_code_seg_sel     equ  0x38    ;???????????? RPL:00???????????DPL = 00
     8                                           core_data_seg_sel     equ  0x30    ;????????????? RPL:00 ???????????DPL = 00
     9                                           sys_routine_seg_sel   equ  0x28    ;?????????????¶≈?????? RPL:00???????????DPL = 00
    10                                           video_ram_seg_sel     equ  0x20    ;????????????????????  RPL:00???????????DPL = 00
    11                                           core_stack_seg_sel    equ  0x18    ;????????????         RPL:00???????????DPL = 00
    12                                           mem_0_4_gb_seg_sel    equ  0x08    ;????0-4GB????¶≈?????? RPL:00???????????DPL = 00
    13                                  
    14                                  ;-------------------------------------------------------------------------------
    15                                           ;??????????????????????????????? 
    16 00000000 [00000000]                       core_length      dd core_end       ;????????????#00
    17                                  
    18 00000004 [00000000]                       sys_routine_seg  dd section.sys_routine.start
    19                                                                              ;???????????¶À??#04
    20                                  
    21 00000008 [00000000]                       core_data_seg    dd section.core_data.start
    22                                                                              ;?????????¶À??#08
    23                                  
    24 0000000C [00000000]                       core_code_seg    dd section.core_code.start
    25                                                                              ;????????¶À??#0c
    26                                  
    27                                  
    28 00000010 [93030000]                       core_entry       dd start          ;????????????#10
    29 00000014 3800                                              dw core_code_seg_sel
    30                                  
    31                                  ;===============================================================================
    32                                           [bits 32]
    33                                  ;===============================================================================
    34                                  SECTION sys_routine vstart=0                ;?????????????? 
    35                                  ;-------------------------------------------------------------------------------
    36                                           ;????????????
    37                                  put_string:                                 ;???0?????????????????? 
    38                                                                              ;????DS:EBX=?????
    39 00000000 51                               push ecx
    40                                    .getc:
    41 00000001 8A0B                             mov cl,[ebx]
    42 00000003 08C9                             or cl,cl
    43 00000005 7408                             jz .exit
    44 00000007 E805000000                       call put_char
    45 0000000C 43                               inc ebx
    46 0000000D EBF2                             jmp .getc
    47                                  
    48                                    .exit:
    49 0000000F 59                               pop ecx
    50 00000010 CB                               retf                               ;?¶Ã???
    51                                  
    52                                  ;-------------------------------------------------------------------------------
    53                                  put_char:                                   ;????????????????,?????
    54                                                                              ;??????????????? 
    55                                                                              ;????CL=???ASCII?? 
    56 00000011 60                               pushad
    57                                  
    58                                           ;???????????¶À??
    59 00000012 66BAD403                         mov dx,0x3d4
    60 00000016 B00E                             mov al,0x0e
    61 00000018 EE                               out dx,al
    62 00000019 6642                             inc dx                             ;0x3d5
    63 0000001B EC                               in al,dx                           ;????
    64 0000001C 88C4                             mov ah,al
    65                                  
    66 0000001E 664A                             dec dx                             ;0x3d4
    67 00000020 B00F                             mov al,0x0f
    68 00000022 EE                               out dx,al
    69 00000023 6642                             inc dx                             ;0x3d5
    70 00000025 EC                               in al,dx                           ;????
    71 00000026 6689C3                           mov bx,ax                          ;BX=???????¶À???16¶À??
    72                                  
    73 00000029 80F90D                           cmp cl,0x0d                        ;???????
    74 0000002C 750E                             jnz .put_0a
    75 0000002E 6689D8                           mov ax,bx
    76 00000031 B350                             mov bl,80
    77 00000033 F6F3                             div bl
    78 00000035 F6E3                             mul bl
    79 00000037 6689C3                           mov bx,ax
    80 0000003A EB60                             jmp .set_cursor
    81                                  
    82                                    .put_0a:
    83 0000003C 80F90A                           cmp cl,0x0a                        ;???ßŸ???
    84 0000003F 7506                             jnz .put_other
    85 00000041 6683C350                         add bx,80
    86 00000045 EB15                             jmp .roll_screen
    87                                  
    88                                    .put_other:                               ;??????????
    89 00000047 06                               push es
    90 00000048 B820000000                       mov eax,video_ram_seg_sel          ;0xb8000?¶≈??????
    91 0000004D 8EC0                             mov es,eax
    92 0000004F 66D1E3                           shl bx,1
    93 00000052 2667880F                         mov [es:bx],cl
    94 00000056 07                               pop es
    95                                  
    96                                           ;????????¶À???????????
    97 00000057 66D1EB                           shr bx,1
    98 0000005A 6643                             inc bx
    99                                  
   100                                    .roll_screen:
   101 0000005C 6681FBD007                       cmp bx,2000                        ;??????????????
   102 00000061 7C39                             jl .set_cursor
   103                                  
   104 00000063 1E                               push ds
   105 00000064 06                               push es
   106 00000065 B820000000                       mov eax,video_ram_seg_sel
   107 0000006A 8ED8                             mov ds,eax
   108 0000006C 8EC0                             mov es,eax
   109 0000006E FC                               cld
   110 0000006F BEA0000000                       mov esi,0xa0                       ;ß≥???32¶À????movsb/w/d 
   111 00000074 BF00000000                       mov edi,0x00                       ;??????esi/edi/ecx 
   112 00000079 B980070000                       mov ecx,1920
   113 0000007E F3A5                             rep movsd
   114 00000080 66BB000F                         mov bx,3840                        ;????????????
   115 00000084 B950000000                       mov ecx,80                         ;32¶À??????????ECX
   116                                    .cls:
   117 00000089 266667C7072007                   mov word[es:bx],0x0720
   118 00000090 6683C302                         add bx,2
   119 00000094 E2F3                             loop .cls
   120                                  
   121 00000096 07                               pop es
   122 00000097 1F                               pop ds
   123                                  
   124 00000098 66BB8007                         mov bx,1920
   125                                  
   126                                    .set_cursor:
   127 0000009C 66BAD403                         mov dx,0x3d4
   128 000000A0 B00E                             mov al,0x0e
   129 000000A2 EE                               out dx,al
   130 000000A3 6642                             inc dx                             ;0x3d5
   131 000000A5 88F8                             mov al,bh
   132 000000A7 EE                               out dx,al
   133 000000A8 664A                             dec dx                             ;0x3d4
   134 000000AA B00F                             mov al,0x0f
   135 000000AC EE                               out dx,al
   136 000000AD 6642                             inc dx                             ;0x3d5
   137 000000AF 88D8                             mov al,bl
   138 000000B1 EE                               out dx,al
   139                                  
   140 000000B2 61                               popad
   141                                           
   142 000000B3 C3                               ret                                
   143                                  
   144                                  ;-------------------------------------------------------------------------------
   145                                  read_hard_disk_0:                           ;?????????????????
   146                                                                              ;EAX=?????????
   147                                                                              ;DS:EBX=??????????
   148                                                                              ;?????EBX=EBX+512
   149 000000B4 50                               push eax 
   150 000000B5 51                               push ecx
   151 000000B6 52                               push edx
   152                                        
   153 000000B7 50                               push eax
   154                                           
   155 000000B8 66BAF201                         mov dx,0x1f2
   156 000000BC B001                             mov al,1
   157 000000BE EE                               out dx,al                          ;???????????
   158                                  
   159 000000BF 6642                             inc dx                             ;0x1f3
   160 000000C1 58                               pop eax
   161 000000C2 EE                               out dx,al                          ;LBA???7~0
   162                                  
   163 000000C3 6642                             inc dx                             ;0x1f4
   164 000000C5 B108                             mov cl,8
   165 000000C7 D3E8                             shr eax,cl
   166 000000C9 EE                               out dx,al                          ;LBA???15~8
   167                                  
   168 000000CA 6642                             inc dx                             ;0x1f5
   169 000000CC D3E8                             shr eax,cl
   170 000000CE EE                               out dx,al                          ;LBA???23~16
   171                                  
   172 000000CF 6642                             inc dx                             ;0x1f6
   173 000000D1 D3E8                             shr eax,cl
   174 000000D3 0CE0                             or al,0xe0                         ;??????  LBA???27~24
   175 000000D5 EE                               out dx,al
   176                                  
   177 000000D6 6642                             inc dx                             ;0x1f7
   178 000000D8 B020                             mov al,0x20                        ;??????
   179 000000DA EE                               out dx,al
   180                                  
   181                                    .waits:
   182 000000DB EC                               in al,dx
   183 000000DC 2488                             and al,0x88
   184 000000DE 3C08                             cmp al,0x08
   185 000000E0 75F9                             jnz .waits                         ;???????????????????????? 
   186                                  
   187 000000E2 B900010000                       mov ecx,256                        ;?????????????
   188 000000E7 66BAF001                         mov dx,0x1f0
   189                                    .readw:
   190 000000EB 66ED                             in ax,dx
   191 000000ED 668903                           mov [ebx],ax
   192 000000F0 83C302                           add ebx,2
   193 000000F3 E2F6                             loop .readw
   194                                  
   195 000000F5 5A                               pop edx
   196 000000F6 59                               pop ecx
   197 000000F7 58                               pop eax
   198                                        
   199 000000F8 CB                               retf                               ;?¶Ã??? 
   200                                  
   201                                  ;-------------------------------------------------------------------------------
   202                                  ;?????????????????¶√?????????????????????????????????? 
   203                                  put_hex_dword:                              ;??????????????????????
   204                                                                              ;????????????? 
   205                                                                              ;????EDX=???????????????
   206                                                                              ;???????
   207 000000F9 60                               pushad
   208 000000FA 1E                               push ds
   209                                        
   210 000000FB 66B83000                         mov ax,core_data_seg_sel           ;?ß›???????????? 
   211 000000FF 8ED8                             mov ds,ax
   212                                        
   213 00000101 BB[2B050000]                     mov ebx,bin_hex                    ;???????????????????
   214 00000106 B908000000                       mov ecx,8
   215                                    .xlt:    
   216 0000010B C1C204                           rol edx,4
   217 0000010E 89D0                             mov eax,edx
   218 00000110 83E00F                           and eax,0x0000000f
   219 00000113 D7                               xlat
   220                                        
   221 00000114 51                               push ecx
   222 00000115 88C1                             mov cl,al                           
   223 00000117 E8F5FEFFFF                       call put_char
   224 0000011C 59                               pop ecx
   225                                         
   226 0000011D E2EC                             loop .xlt
   227                                        
   228 0000011F 1F                               pop ds
   229 00000120 61                               popad
   230 00000121 CB                               retf
   231                                        
   232                                  ;-------------------------------------------------------------------------------
   233                                  allocate_memory:                            ;???????
   234                                                                              ;????ECX=?????????????
   235                                                                              ;?????ECX=????????? 
   236 00000122 1E                               push ds
   237 00000123 50                               push eax
   238 00000124 53                               push ebx
   239                                        
   240 00000125 B830000000                       mov eax,core_data_seg_sel
   241 0000012A 8ED8                             mov ds,eax
   242                                        
   243 0000012C A1[06000000]                     mov eax,[ram_alloc]
   244 00000131 01C8                             add eax,ecx                        ;????¶«????????????
   245                                        
   246                                           ;????????ßﬁ?????????????????
   247                                            
   248 00000133 8B0D[06000000]                   mov ecx,[ram_alloc]                ;??????????????
   249                                  
   250 00000139 89C3                             mov ebx,eax
   251 0000013B 83E3FC                           and ebx,0xfffffffc
   252 0000013E 83C304                           add ebx,4                          ;?????? 
   253 00000141 A903000000                       test eax,0x00000003                ;??¶«???????????????4??????
   254 00000146 0F45C3                           cmovnz eax,ebx                     ;?????ßÿ??????????? 
   255 00000149 A3[06000000]                     mov [ram_alloc],eax                ;??¶ƒ???????????
   256                                                                              ;cmovcc??????????????? 
   257 0000014E 5B                               pop ebx
   258 0000014F 58                               pop eax
   259 00000150 1F                               pop ds
   260                                  
   261 00000151 CB                               retf
   262                                  
   263                                  ;-------------------------------------------------------------------------------
   264                                  set_up_gdt_descriptor:                      ;??GDT????????????????
   265                                                                              ;????EDX:EAX=?????? 
   266                                                                              ;?????CX=?????????????
   267 00000152 50                               push eax
   268 00000153 53                               push ebx
   269 00000154 52                               push edx
   270                                  
   271 00000155 1E                               push ds
   272 00000156 06                               push es
   273                                  
   274 00000157 BB30000000                       mov ebx,core_data_seg_sel          ;?ß›????????????
   275 0000015C 8EDB                             mov ds,ebx
   276                                  
   277 0000015E 0F0105[00000000]                 sgdt [pgdt]                        ;????????GDT
   278                                  
   279 00000165 BB08000000                       mov ebx,mem_0_4_gb_seg_sel
   280 0000016A 8EC3                             mov es,ebx
   281                                  
   282 0000016C 0FB71D[00000000]                 movzx ebx,word [pgdt]              ;GDT????
   283 00000173 6643                             inc bx                             ;GDT??????????????????????????
   284 00000175 031D[02000000]                   add ebx,[pgdt+2]                   ;???????????????????
   285                                  
   286 0000017B 268903                           mov [es:ebx],eax
   287 0000017E 26895304                         mov [es:ebx+4],edx
   288                                  
   289 00000182 668305[00000000]08               add word [pgdt],8                  ;????????????????ß≥
   290                                  
   291 0000018A 0F0115[00000000]                 lgdt [pgdt]                        ;??GDT???????ßπ
   292                                  
   293 00000191 66A1[00000000]                   mov ax,[pgdt]                      ;???GDT?????
   294 00000197 6631D2                           xor dx,dx
   295 0000019A 66BB0800                         mov bx,8
   296 0000019E 66F7F3                           div bx                             ;????8?????????
   297 000001A1 6689C1                           mov cx,ax
   298 000001A4 66C1E103                         shl cx,3                           ;??????????????¶À??
   299                                  
   300 000001A8 07                               pop es
   301 000001A9 1F                               pop ds
   302                                  
   303 000001AA 5A                               pop edx
   304 000001AB 5B                               pop ebx
   305 000001AC 58                               pop eax
   306                                  
   307 000001AD CB                               retf
   308                                  ;-------------------------------------------------------------------------------
   309                                  make_seg_descriptor:                        ;????õ•???????????????
   310                                                                              ;????EAX=????????
   311                                                                              ;      EBX=?¶Õ???
   312                                                                              ;      ECX=???????????¶À??????
   313                                                                              ;          ¶À???????¶À???? 
   314                                                                              ;?????EDX:EAX=??????
   315 000001AE 89C2                             mov edx,eax
   316 000001B0 C1E010                           shl eax,16
   317 000001B3 6609D8                           or ax,bx                           ;???????32¶À(EAX)???????
   318                                  
   319 000001B6 81E20000FFFF                     and edx,0xffff0000                 ;??????????????¶À
   320 000001BC C1C208                           rol edx,8
   321 000001BF 0FCA                             bswap edx                          ;???????31~24??23~16  (80486+)
   322                                  
   323 000001C1 6631DB                           xor bx,bx
   324 000001C4 09DA                             or edx,ebx                         ;???¶Õ?????4¶À
   325                                  
   326 000001C6 09CA                             or edx,ecx                         ;???????
   327                                  
   328 000001C8 CB                               retf
   329                                  
   330                                  ;-------------------------------------------------------------------------------
   331                                  make_gate_descriptor:                       ;???????????????????????
   332                                                                              ;????EAX=???????????????
   333                                                                              ;       BX=?????????¶≈?????? 
   334                                                                              ;       CX=?????????????????
   335                                                                              ;          ??¶À??????¶À???
   336                                                                              ;?????EDX:EAX=????????????
   337 000001C9 53                               push ebx
   338 000001CA 51                               push ecx
   339                                        
   340 000001CB 89C2                             mov edx,eax
   341 000001CD 81E20000FFFF                     and edx,0xffff0000                 ;??????????16¶À 
   342 000001D3 6609CA                           or dx,cx                           ;???????????EDX
   343                                         
   344 000001D6 25FFFF0000                       and eax,0x0000ffff                 ;??????????16¶À 
   345 000001DB C1E310                           shl ebx,16                          
   346 000001DE 09D8                             or eax,ebx                         ;?????????????
   347                                        
   348 000001E0 59                               pop ecx
   349 000001E1 5B                               pop ebx
   350                                        
   351 000001E2 CB                               retf                                   
   352                                                               
   353                                  sys_routine_end:
   354                                  
   355                                  
   356                                  
   357                                  
   358                                  ;===============================================================================
   359                                  SECTION core_data vstart=0                  ;???????????? 
   360                                  ;------------------------------------------------------------------------------- 
   361 00000000 0000                             pgdt             dw  0             ;???????®≤????GDT 
   362 00000002 00000000                                          dd  0
   363                                  
   364 00000006 00001000                         ram_alloc        dd  0x00100000    ;??¶«???????????????
   365                                  
   366                                           ;????????????
   367                                           salt:
   368 0000000A 405072696E74537472-              salt_1           db  '@PrintString'
   368 00000013 696E67             
   369 00000016 00<rept>                                     times 256-($-salt_1) db 0
   370 0000010A [00000000]                                        dd  put_string
   371 0000010E 2800                                              dw  sys_routine_seg_sel
   372                                  
   373 00000110 40526561644469736B-              salt_2           db  '@ReadDiskData'
   373 00000119 44617461           
   374 0000011D 00<rept>                                     times 256-($-salt_2) db 0
   375 00000210 [B4000000]                                        dd  read_hard_disk_0
   376 00000214 2800                                              dw  sys_routine_seg_sel
   377                                  
   378 00000216 405072696E7444776F-              salt_3           db  '@PrintDwordAsHexString'
   378 0000021F 726441734865785374-
   378 00000228 72696E67           
   379 0000022C 00<rept>                                     times 256-($-salt_3) db 0
   380 00000316 [F9000000]                                        dd  put_hex_dword
   381 0000031A 2800                                              dw  sys_routine_seg_sel
   382                                  
   383 0000031C 405465726D696E6174-              salt_4           db  '@TerminateProgram'
   383 00000325 6550726F6772616D   
   384 0000032D 00<rept>                                     times 256-($-salt_4) db 0
   385 0000041C [C3040000]                                        dd  return_point
   386 00000420 3800                                              dw  core_code_seg_sel
   387                                  
   388                                           salt_item_len   equ $-salt_4
   389                                           salt_items      equ ($-salt)/salt_item_len
   390                                  
   391 00000422 2020496620796F7520-              message_1        db  '  If you seen this message,that means we '
   391 0000042B 7365656E2074686973-
   391 00000434 206D6573736167652C-
   391 0000043D 74686174206D65616E-
   391 00000446 7320776520         
   392 0000044B 617265206E6F772069-                               db  'are now in protect mode,and the system '
   392 00000454 6E2070726F74656374-
   392 0000045D 206D6F64652C616E64-
   392 00000466 207468652073797374-
   392 0000046F 656D20             
   393 00000472 636F7265206973206C-                               db  'core is loaded,and the video display '
   393 0000047B 6F616465642C616E64-
   393 00000484 207468652076696465-
   393 0000048D 6F20646973706C6179-
   393 00000496 20                 
   394 00000497 726F7574696E652077-                               db  'routine works perfectly.',0x0d,0x0a,0
   394 000004A0 6F726B732070657266-
   394 000004A9 6563746C792E0D0A00 
   395                                  
   396 000004B2 202053797374656D20-              message_2        db  '  System wide CALL-GATE mounted.',0x0d,0x0a,0
   396 000004BB 776964652043414C4C-
   396 000004C4 2D47415445206D6F75-
   396 000004CD 6E7465642E0D0A00   
   397                                           
   398 000004D5 0D0A20204C6F616469-              message_3        db  0x0d,0x0a,'  Loading user program...',0
   398 000004DE 6E6720757365722070-
   398 000004E7 726F6772616D2E2E2E-
   398 000004F0 00                 
   399                                           
   400 000004F1 446F6E652E0D0A00                 do_status        db  'Done.',0x0d,0x0a,0
   401                                           
   402 000004F9 0D0A0D0A0D0A                     message_6        db  0x0d,0x0a,0x0d,0x0a,0x0d,0x0a
   403 000004FF 202055736572207072-                               db  '  User program terminated,control returned.',0
   403 00000508 6F6772616D20746572-
   403 00000511 6D696E617465642C63-
   403 0000051A 6F6E74726F6C207265-
   403 00000523 7475726E65642E00   
   404                                  
   405 0000052B 303132333435363738-              bin_hex          db '0123456789ABCDEF'
   405 00000534 39414243444546     
   406                                                                              ;put_hex_dword???????????? 
   407                                  
   408 0000053B 00<rept>                         core_buf   times 2048 db 0         ;???????????
   409                                  
   410 00000D3B 00000000                         esp_pointer      dd 0              ;???????????????????????     
   411                                  
   412 00000D3F 0D0A202000                       cpu_brnd0        db 0x0d,0x0a,'  ',0
   413 00000D44 00<rept>                         cpu_brand  times 52 db 0
   414 00000D78 0D0A0D0A00                       cpu_brnd1        db 0x0d,0x0a,0x0d,0x0a,0
   415                                  
   416                                           ;??????????
   417 00000D7D 00000000                         tcb_chain        dd  0
   418                                  
   419                                  core_data_end:
   420                                                 
   421                                  ;===============================================================================
   422                                  SECTION core_code vstart=0                  ;??????????
   423                                  ;-------------------------------------------------------------------------------
   424                                  fill_descriptor_in_ldt:                     ;??LDT????????????????
   425                                                                              ;????EDX:EAX=??????
   426                                                                              ;          EBX=TCB?????
   427                                                                              ;?????CX=?????????????
   428 00000000 50                               push eax
   429 00000001 52                               push edx
   430 00000002 57                               push edi
   431 00000003 1E                               push ds
   432                                  
   433 00000004 B908000000                       mov ecx,mem_0_4_gb_seg_sel
   434 00000009 8ED9                             mov ds,ecx
   435                                  
   436 0000000B 8B7B0C                           mov edi,[ebx+0x0c]                 ;???LDT?????
   437                                           
   438 0000000E 31C9                             xor ecx,ecx
   439 00000010 668B4B0A                         mov cx,[ebx+0x0a]                  ;???LDT????
   440 00000014 6641                             inc cx                             ;LDT??????????????????????????
   441                                           
   442 00000016 89040F                           mov [edi+ecx+0x00],eax
   443 00000019 89540F04                         mov [edi+ecx+0x04],edx             ;?????????
   444                                  
   445 0000001D 6683C108                         add cx,8                           
   446 00000021 6649                             dec cx                             ;??????LDT????? 
   447                                  
   448 00000023 66894B0A                         mov [ebx+0x0a],cx                  ;????LDT???????TCB
   449                                  
   450 00000027 6689C8                           mov ax,cx
   451 0000002A 6631D2                           xor dx,dx
   452 0000002D 66B90800                         mov cx,8
   453 00000031 66F7F1                           div cx
   454                                           
   455 00000034 6689C1                           mov cx,ax
   456 00000037 66C1E103                         shl cx,3                           ;????3¶À??????
   457 0000003B 6683C904                         or cx,0000_0000_0000_0100B         ;?TI¶À=1?????LDT??????RPL=00 
   458                                  
   459 0000003F 1F                               pop ds
   460 00000040 5F                               pop edi
   461 00000041 5A                               pop edx
   462 00000042 58                               pop eax
   463                                       
   464 00000043 C3                               ret
   465                                        
   466                                  ;------------------------------------------------------------------------------- 
   467                                  load_relocate_program:                      ;????????¶À???????
   468                                                                              ;????: PUSH ?????????
   469                                                                              ;      PUSH ????????????
   470                                                                              ;??????? 
   471 00000044 60                               pushad
   472                                        
   473 00000045 1E                               push ds
   474 00000046 06                               push es
   475                                        
   476 00000047 89E5                             mov ebp,esp                        ;????????????????????????
   477                                        
   478 00000049 B908000000                       mov ecx,mem_0_4_gb_seg_sel
   479 0000004E 8EC1                             mov es,ecx
   480                                        
   481 00000050 8B752C                           mov esi,[ebp+11*4]                 ;?????????TCB??????
   482                                  
   483                                           ;??????????LDT??????????
   484 00000053 B9A0000000                       mov ecx,160                        ;???????20??LDT??????
   485 00000058 9A[22010000]2800                 call sys_routine_seg_sel:allocate_memory
   486 0000005F 26894E0C                         mov [es:esi+0x0c],ecx              ;???LDT???????TCB??
   487 00000063 2666C7460AFFFF                   mov word [es:esi+0x0a],0xffff      ;???LDT?????????TCB?? 
   488                                  
   489                                           ;????????????????? 
   490 0000006A B830000000                       mov eax,core_data_seg_sel
   491 0000006F 8ED8                             mov ds,eax                         ;?ß›?DS??????????
   492                                         
   493 00000071 8B4530                           mov eax,[ebp+12*4]                 ;????????????????????????? 
   494 00000074 BB[3B050000]                     mov ebx,core_buf                   ;??????????????     
   495 00000079 9A[B4000000]2800                 call sys_routine_seg_sel:read_hard_disk_0
   496                                  
   497                                           ;?????ßÿ??????????ßÿ??
   498 00000080 A1[3B050000]                     mov eax,[core_buf]                 ;??????
   499 00000085 89C3                             mov ebx,eax
   500 00000087 81E300FEFFFF                     and ebx,0xfffffe00                 ;??512?????????512?????????? 
   501 0000008D 81C300020000                     add ebx,512                        ;9¶À???0 
   502 00000093 A9FF010000                       test eax,0x000001ff                ;??????ß≥??????512???????? 
   503 00000098 0F45C3                           cmovnz eax,ebx                     ;???????????????
   504                                        
   505 0000009B 89C1                             mov ecx,eax                        ;??????????????????
   506 0000009D 9A[22010000]2800                 call sys_routine_seg_sel:allocate_memory
   507 000000A4 26894E06                         mov [es:esi+0x06],ecx              ;???????????????TCB??
   508                                        
   509 000000A8 89CB                             mov ebx,ecx                        ;ebx -> ?????????????
   510 000000AA 31D2                             xor edx,edx
   511 000000AC B900020000                       mov ecx,512
   512 000000B1 F7F1                             div ecx
   513 000000B3 89C1                             mov ecx,eax                        ;???????? 
   514                                        
   515 000000B5 B808000000                       mov eax,mem_0_4_gb_seg_sel         ;?ß›?DS??0-4GB???
   516 000000BA 8ED8                             mov ds,eax
   517                                  
   518 000000BC 8B4530                           mov eax,[ebp+12*4]                 ;????????? 
   519                                    .b1:
   520 000000BF 9A[B4000000]2800                 call sys_routine_seg_sel:read_hard_disk_0
   521 000000C6 40                               inc eax
   522 000000C7 E2F6                             loop .b1                           ;?????????????????????????
   523                                  
   524 000000C9 268B7E06                         mov edi,[es:esi+0x06]              ;??®Æ??????????
   525                                  
   526                                           ;???????????????????
   527 000000CD 89F8                             mov eax,edi                        ;????????????????
   528 000000CF 8B5F04                           mov ebx,[edi+0x04]                 ;?¶√???
   529 000000D2 4B                               dec ebx                            ;?¶Õ???
   530 000000D3 B900F24000                       mov ecx,0x0040f200                 ;??????????????????????????3 
   531 000000D8 9A[AE010000]2800                 call sys_routine_seg_sel:make_seg_descriptor
   532                                        
   533                                           ;????????????????LDT?? 
   534 000000DF 89F3                             mov ebx,esi                        ;TCB??????
   535 000000E1 E81AFFFFFF                       call fill_descriptor_in_ldt
   536                                  
   537 000000E6 6683C903                         or cx,0000_0000_0000_0011B         ;????????????????3
   538 000000EA 2666894E44                       mov [es:esi+0x44],cx               ;?????????????????TCB 
   539 000000EF 66894F04                         mov [edi+0x04],cx                  ;?????????????? 
   540                                        
   541                                           ;??????????????????
   542 000000F3 89F8                             mov eax,edi
   543 000000F5 034714                           add eax,[edi+0x14]                 ;?????????????
   544 000000F8 8B5F18                           mov ebx,[edi+0x18]                 ;?¶√???
   545 000000FB 4B                               dec ebx                            ;?¶Õ???
   546 000000FC B900F84000                       mov ecx,0x0040f800                 ;?????????????????????????3
   547 00000101 9A[AE010000]2800                 call sys_routine_seg_sel:make_seg_descriptor
   548 00000108 89F3                             mov ebx,esi                        ;TCB??????
   549 0000010A E8F1FEFFFF                       call fill_descriptor_in_ldt
   550 0000010F 6683C903                         or cx,0000_0000_0000_0011B         ;????????????????3
   551 00000113 66894F14                         mov [edi+0x14],cx                  ;????????????????
   552                                  
   553                                           ;???????????????????
   554 00000117 89F8                             mov eax,edi
   555 00000119 03471C                           add eax,[edi+0x1c]                 ;??????????????
   556 0000011C 8B5F20                           mov ebx,[edi+0x20]                 ;?¶√???
   557 0000011F 4B                               dec ebx                            ;?¶Õ??? 
   558 00000120 B900F24000                       mov ecx,0x0040f200                 ;??????????????????????????3
   559 00000125 9A[AE010000]2800                 call sys_routine_seg_sel:make_seg_descriptor
   560 0000012C 89F3                             mov ebx,esi                        ;TCB??????
   561 0000012E E8CDFEFFFF                       call fill_descriptor_in_ldt
   562 00000133 6683C903                         or cx,0000_0000_0000_0011B         ;????????????????3
   563 00000137 66894F1C                         mov [edi+0x1c],cx                  ;?????????????????
   564                                  
   565                                           ;??????????????????
   566 0000013B 8B4F0C                           mov ecx,[edi+0x0c]                 ;4KB????? 
   567 0000013E BBFFFF0F00                       mov ebx,0x000fffff
   568 00000143 29CB                             sub ebx,ecx                        ;????¶Õ???
   569 00000145 B800100000                       mov eax,4096                        
   570 0000014A F7E1                             mul ecx                         
   571 0000014C 89C1                             mov ecx,eax                        ;?????????????? 
   572 0000014E 9A[22010000]2800                 call sys_routine_seg_sel:allocate_memory
   573 00000155 01C8                             add eax,ecx                        ;????????????????? 
   574 00000157 B900F6C000                       mov ecx,0x00c0f600                 ;?????????????????????????3
   575 0000015C 9A[AE010000]2800                 call sys_routine_seg_sel:make_seg_descriptor
   576 00000163 89F3                             mov ebx,esi                        ;TCB??????
   577 00000165 E896FEFFFF                       call fill_descriptor_in_ldt
   578 0000016A 6683C903                         or cx,0000_0000_0000_0011B         ;????????????????3
   579 0000016E 66894F08                         mov [edi+0x08],cx                  ;????????????????
   580                                  
   581                                           ;???¶ÀSALT 
   582 00000172 B808000000                       mov eax,mem_0_4_gb_seg_sel         ;????????????????????????
   583 00000177 8EC0                             mov es,eax                         ;???????????????ßπ????????
   584                                                                              ;??4GB?¶«?????????????          
   585 00000179 B830000000                       mov eax,core_data_seg_sel
   586 0000017E 8ED8                             mov ds,eax
   587                                        
   588 00000180 FC                               cld
   589                                  
   590 00000181 268B4F24                         mov ecx,[es:edi+0x24]              ;U-SALT?????(???????4GB?????) 
   591 00000185 83C728                           add edi,0x28                       ;U-SALT??4GB???????? 
   592                                    .b2: 
   593 00000188 51                               push ecx
   594 00000189 57                               push edi
   595                                        
   596 0000018A B904000000                       mov ecx,salt_items
   597 0000018F BE[0A000000]                     mov esi,salt
   598                                    .b3:
   599 00000194 57                               push edi
   600 00000195 56                               push esi
   601 00000196 51                               push ecx
   602                                  
   603 00000197 B940000000                       mov ecx,64                         ;???????ßµ???????????? 
   604 0000019C F3A7                             repe cmpsd                         ;??¶¡??4??? 
   605 0000019E 7519                             jnz .b4
   606 000001A0 8B06                             mov eax,[esi]                      ;???????esi????????????
   607 000001A2 26898700FFFFFF                   mov [es:edi-256],eax               ;?????????ß’??????? 
   608 000001A9 668B4604                         mov ax,[esi+4]
   609 000001AD 6683C803                         or ax,0000000000000011B            ;???????????????????????????
   610                                                                              ;??RPL=3 
   611 000001B1 2666898704FFFFFF                 mov [es:edi-252],ax                ;?????????????? 
   612                                    .b4:
   613                                        
   614 000001B9 59                               pop ecx
   615 000001BA 5E                               pop esi
   616 000001BB 81C606010000                     add esi,salt_item_len
   617 000001C1 5F                               pop edi                            ;?????? 
   618 000001C2 E2D0                             loop .b3
   619                                        
   620 000001C4 5F                               pop edi
   621 000001C5 81C700010000                     add edi,256
   622 000001CB 59                               pop ecx
   623 000001CC E2BA                             loop .b2
   624                                  
   625 000001CE 8B752C                           mov esi,[ebp+11*4]                 ;?????????TCB??????
   626                                  
   627                                           ;????0????????
   628 000001D1 B900100000                       mov ecx,4096
   629 000001D6 89C8                             mov eax,ecx                        ;????????????????? 
   630 000001D8 26894E1A                         mov [es:esi+0x1a],ecx
   631 000001DC 26C16E1A0C                       shr dword [es:esi+0x1a],12         ;???0??????????ΩÖTCB 
   632 000001E1 9A[22010000]2800                 call sys_routine_seg_sel:allocate_memory
   633 000001E8 01C8                             add eax,ecx                        ;????????????????????
   634 000001EA 2689461E                         mov [es:esi+0x1e],eax              ;???0???????????????TCB 
   635 000001EE BBFEFF0F00                       mov ebx,0xffffe                    ;?¶√?????????
   636 000001F3 B90096C000                       mov ecx,0x00c09600                 ;4KB???????ß’???????0
   637 000001F8 9A[AE010000]2800                 call sys_routine_seg_sel:make_seg_descriptor
   638 000001FF 89F3                             mov ebx,esi                        ;TCB??????
   639 00000201 E8FAFDFFFF                       call fill_descriptor_in_ldt
   640                                           ;or cx,0000_0000_0000_0000          ;????????????????0
   641 00000206 2666894E22                       mov [es:esi+0x22],cx               ;???0??????????????TCB
   642 0000020B 26C7462400000000                 mov dword [es:esi+0x24],0          ;???0???????????ESP??TCB
   643                                        
   644                                           ;????1????????
   645 00000213 B900100000                       mov ecx,4096
   646 00000218 89C8                             mov eax,ecx                        ;?????????????????
   647 0000021A 26894E28                         mov [es:esi+0x28],ecx
   648 0000021E 26C16E280C                       shr dword [es:esi+0x28],12               ;???1??????????ΩÖTCB
   649 00000223 9A[22010000]2800                 call sys_routine_seg_sel:allocate_memory
   650 0000022A 01C8                             add eax,ecx                        ;????????????????????
   651 0000022C 2689462C                         mov [es:esi+0x2c],eax              ;???1???????????????TCB
   652 00000230 BBFEFF0F00                       mov ebx,0xffffe                    ;?¶√?????????
   653 00000235 B900B6C000                       mov ecx,0x00c0b600                 ;4KB???????ß’???????1
   654 0000023A 9A[AE010000]2800                 call sys_routine_seg_sel:make_seg_descriptor
   655 00000241 89F3                             mov ebx,esi                        ;TCB??????
   656 00000243 E8B8FDFFFF                       call fill_descriptor_in_ldt
   657 00000248 6683C901                         or cx,0000_0000_0000_0001          ;????????????????1
   658 0000024C 2666894E30                       mov [es:esi+0x30],cx               ;???1??????????????TCB
   659 00000251 26C7463200000000                 mov dword [es:esi+0x32],0          ;???1???????????ESP??TCB
   660                                  
   661                                           ;????2????????
   662 00000259 B900100000                       mov ecx,4096
   663 0000025E 89C8                             mov eax,ecx                        ;?????????????????
   664 00000260 26894E36                         mov [es:esi+0x36],ecx
   665 00000264 26C16E360C                       shr dword [es:esi+0x36],12               ;???2??????????ΩÖTCB
   666 00000269 9A[22010000]2800                 call sys_routine_seg_sel:allocate_memory
   667 00000270 01C8                             add eax,ecx                        ;????????????????????
   668 00000272 26894E3A                         mov [es:esi+0x3a],ecx              ;???2???????????????TCB
   669 00000276 BBFEFF0F00                       mov ebx,0xffffe                    ;?¶√?????????
   670 0000027B B900D6C000                       mov ecx,0x00c0d600                 ;4KB???????ß’???????2
   671 00000280 9A[AE010000]2800                 call sys_routine_seg_sel:make_seg_descriptor
   672 00000287 89F3                             mov ebx,esi                        ;TCB??????
   673 00000289 E872FDFFFF                       call fill_descriptor_in_ldt
   674 0000028E 6683C90A                         or cx,0000_0000_0000_0010          ;????????????????2
   675 00000292 2666894E3E                       mov [es:esi+0x3e],cx               ;???2??????????????TCB
   676 00000297 26C7464000000000                 mov dword [es:esi+0x40],0          ;???2???????????ESP??TCB
   677                                        
   678                                           ;??GDT?ß÷??LDT??????
   679 0000029F 268B460C                         mov eax,[es:esi+0x0c]              ;LDT???????????
   680 000002A3 260FB75E0A                       movzx ebx,word [es:esi+0x0a]       ;LDT?¶Õ???
   681 000002A8 B900824000                       mov ecx,0x00408200                 ;LDT?????????????0
   682 000002AD 9A[AE010000]2800                 call sys_routine_seg_sel:make_seg_descriptor
   683 000002B4 9A[52010000]2800                 call sys_routine_seg_sel:set_up_gdt_descriptor
   684 000002BB 2666894E10                       mov [es:esi+0x10],cx               ;???LDT??????TCB??
   685                                         
   686                                           ;????????????TSS
   687 000002C0 B968000000                       mov ecx,104                        ;tss????????
   688 000002C5 2666894E12                       mov [es:esi+0x12],cx              
   689 000002CA 2666FF4E12                       dec word [es:esi+0x12]             ;???TSS???????TCB 
   690 000002CF 9A[22010000]2800                 call sys_routine_seg_sel:allocate_memory
   691 000002D6 26894E14                         mov [es:esi+0x14],ecx              ;???TSS???????TCB
   692                                        
   693                                           ;????????TSS????????
   694 000002DA 2666C7010000                     mov word [es:ecx+0],0              ;??????=0
   695                                        
   696 000002E0 268B5624                         mov edx,[es:esi+0x24]              ;???0???????????ESP
   697 000002E4 26895104                         mov [es:ecx+4],edx                 ;??TSS??
   698                                        
   699 000002E8 26668B5622                       mov dx,[es:esi+0x22]               ;???0???????????????
   700 000002ED 2666895108                       mov [es:ecx+8],dx                  ;??TSS??
   701                                        
   702 000002F2 268B5632                         mov edx,[es:esi+0x32]              ;???1???????????ESP
   703 000002F6 2689510C                         mov [es:ecx+12],edx                ;??TSS??
   704                                  
   705 000002FA 26668B5630                       mov dx,[es:esi+0x30]               ;???1???????????????
   706 000002FF 2666895110                       mov [es:ecx+16],dx                 ;??TSS??
   707                                  
   708 00000304 268B5640                         mov edx,[es:esi+0x40]              ;???2???????????ESP
   709 00000308 26895114                         mov [es:ecx+20],edx                ;??TSS??
   710                                  
   711 0000030C 26668B563E                       mov dx,[es:esi+0x3e]               ;???2???????????????
   712 00000311 2666895118                       mov [es:ecx+24],dx                 ;??TSS??
   713                                  
   714 00000316 26668B5610                       mov dx,[es:esi+0x10]               ;????????LDT?????
   715 0000031B 2666895160                       mov [es:ecx+96],dx                 ;??TSS??
   716                                        
   717 00000320 26668B5612                       mov dx,[es:esi+0x12]               ;????????I/O¶À????
   718 00000325 2666895166                       mov [es:ecx+102],dx                ;??TSS?? 
   719                                        
   720 0000032A 2666C741640000                   mov word [es:ecx+100],0            ;T=0
   721                                         
   722                                           ;??GDT?ß÷??TSS??????
   723 00000331 268B4614                         mov eax,[es:esi+0x14]              ;TSS???????????
   724 00000335 260FB75E12                       movzx ebx,word [es:esi+0x12]       ;?¶√?????????
   725 0000033A B900894000                       mov ecx,0x00408900                 ;TSS?????????????0
   726 0000033F 9A[AE010000]2800                 call sys_routine_seg_sel:make_seg_descriptor
   727 00000346 9A[52010000]2800                 call sys_routine_seg_sel:set_up_gdt_descriptor
   728 0000034D 2666894E18                       mov [es:esi+0x18],cx               ;???TSS??????TCB
   729                                  
   730 00000352 07                               pop es                             ;????????????????es?? 
   731 00000353 1F                               pop ds                             ;????????????????ds??
   732                                        
   733 00000354 61                               popad
   734                                        
   735 00000355 C20800                           ret 8                              ;????????????????????? 
   736                                        
   737                                  ;-------------------------------------------------------------------------------
   738                                  append_to_tcb_link:                         ;??TCB???????????????
   739                                                                              ;????ECX=TCB????????
   740 00000358 50                               push eax
   741 00000359 52                               push edx
   742 0000035A 1E                               push ds
   743 0000035B 06                               push es
   744                                           
   745 0000035C B830000000                       mov eax,core_data_seg_sel          ;??DS??????????? 
   746 00000361 8ED8                             mov ds,eax
   747 00000363 B808000000                       mov eax,mem_0_4_gb_seg_sel         ;??ES???0..4GB??
   748 00000368 8EC0                             mov es,eax
   749                                           
   750 0000036A 26C70100000000                   mov dword [es: ecx+0x00],0         ;???TCB???????????????????
   751                                                                              ;?????TCB
   752                                                                               
   753 00000371 A1[7D0D0000]                     mov eax,[tcb_chain]                ;TCB??????
   754 00000376 09C0                             or eax,eax                         ;????????
   755 00000378 740E                             jz .notcb 
   756                                           
   757                                    .searc:
   758 0000037A 89C2                             mov edx,eax
   759 0000037C 268B02                           mov eax,[es: edx+0x00]
   760 0000037F 09C0                             or eax,eax               
   761 00000381 75F7                             jnz .searc
   762                                           
   763 00000383 26890A                           mov [es: edx+0x00],ecx
   764 00000386 EB06                             jmp .retpc
   765                                           
   766                                    .notcb:       
   767 00000388 890D[7D0D0000]                   mov [tcb_chain],ecx                ;?????????????????????TCB
   768                                           
   769                                    .retpc:
   770 0000038E 07                               pop es
   771 0000038F 1F                               pop ds
   772 00000390 5A                               pop edx
   773 00000391 58                               pop eax
   774                                           
   775 00000392 C3                               ret
   776                                           
   777                                  ;-------------------------------------------------------------------------------
   778                                  start:
   779 00000393 B930000000                       mov ecx,core_data_seg_sel          ;?ds??????????? 
   780 00000398 8ED9                             mov ds,ecx
   781                                  
   782 0000039A BB[22040000]                     mov ebx,message_1                    
   783 0000039F 9A[00000000]2800                 call sys_routine_seg_sel:put_string
   784                                                                           
   785                                           ;??????????????? 
   786 000003A6 B802000080                       mov eax,0x80000002
   787 000003AB 0FA2                             cpuid
   788 000003AD A3[440D0000]                     mov [cpu_brand + 0x00],eax
   789 000003B2 891D[480D0000]                   mov [cpu_brand + 0x04],ebx
   790 000003B8 890D[4C0D0000]                   mov [cpu_brand + 0x08],ecx
   791 000003BE 8915[500D0000]                   mov [cpu_brand + 0x0c],edx
   792                                        
   793 000003C4 B803000080                       mov eax,0x80000003
   794 000003C9 0FA2                             cpuid
   795 000003CB A3[540D0000]                     mov [cpu_brand + 0x10],eax
   796 000003D0 891D[580D0000]                   mov [cpu_brand + 0x14],ebx
   797 000003D6 890D[5C0D0000]                   mov [cpu_brand + 0x18],ecx
   798 000003DC 8915[600D0000]                   mov [cpu_brand + 0x1c],edx
   799                                  
   800 000003E2 B804000080                       mov eax,0x80000004
   801 000003E7 0FA2                             cpuid
   802 000003E9 A3[640D0000]                     mov [cpu_brand + 0x20],eax
   803 000003EE 891D[680D0000]                   mov [cpu_brand + 0x24],ebx
   804 000003F4 890D[6C0D0000]                   mov [cpu_brand + 0x28],ecx
   805 000003FA 8915[700D0000]                   mov [cpu_brand + 0x2c],edx
   806                                  
   807 00000400 BB[3F0D0000]                     mov ebx,cpu_brnd0                  ;??????????????? 
   808 00000405 9A[00000000]2800                 call sys_routine_seg_sel:put_string
   809 0000040C BB[440D0000]                     mov ebx,cpu_brand
   810 00000411 9A[00000000]2800                 call sys_routine_seg_sel:put_string
   811 00000418 BB[780D0000]                     mov ebx,cpu_brnd1
   812 0000041D 9A[00000000]2800                 call sys_routine_seg_sel:put_string
   813                                  
   814                                           ;??????????????????????????????????????????????????
   815 00000424 BF[0A000000]                     mov edi,salt                       ;C-SALT???????¶À?? C????kernal
   816 00000429 B904000000                       mov ecx,salt_items                 ;C-SALT??????????? C????kernal
   817                                    .b3:
   818 0000042E 51                               push ecx                           ;????EXC??EXC?????????????                      
   819 0000042F 8B8700010000                     mov eax,[edi+256]                  ;?????????????32¶À????? 
   820 00000435 668B9F04010000                   mov bx,[edi+260]                   ;??????????????????? 
   821 0000043C 66B900EC                         mov cx,1_11_0_1100_000_00000B      ;?????3???????(3????????????
   822                                                                              ;????????)??0??????(????®π????
   823                                                                              ;?????????????????) 
   824                                  
   825                                  
   826 00000440 9A[C9010000]2800                 call sys_routine_seg_sel:make_gate_descriptor
   827                                  ;-------------------------------------------------------------------------------
   828                                                                              ;???????????????????????
   829                                                                              ;????EAX=???????????????
   830                                                                              ;       BX=?????????¶≈?????? 
   831                                                                              ;       CX=?????????????????
   832                                                                              ;          ??¶À??????¶À???
   833                                                                              ;?????EDX:EAX=????????????
   834                                  
   835 00000447 9A[52010000]2800                 call sys_routine_seg_sel:set_up_gdt_descriptor   ;??GDT???ßµ?????GDT???ß—???????????
   836                                  ;-------------------------------------------------------------------------------
   837                                                                              ;??GDT????????????????
   838                                                                              ;????EDX:EAX=?????? 
   839                                                                              ;?????CX=?????????????
   840                                  
   841 0000044E 66898F04010000                   mov [edi+260],cx                   ;???????????????????????????????????????????????????????????
   842                                           ;mov dword [edi+256],0x00000000    ;????????????????ß≥??????????????32¶À????? ????????????????????????
   843                                  
   844 00000455 81C706010000                     add edi,salt_item_len              ;????????C-SALT??? 
   845 0000045B 59                               pop ecx
   846 0000045C E2D0                             loop .b3
   847                                  
   848                                           ;??????ß”??? 
   849 0000045E BB[B2040000]                     mov ebx,message_2                  
   850 00000463 FF1D[0A010000]                   call far [salt_1+256]              ;???????????(?????????????) 
   851                                  
   852                                           ;TODO:
   853                                           ;mov ebx,message_2                 ;????CPL?????????
   854                                           ;jmp far [salt_1+256]              ;???????????(?????????????) 
   855                                  
   856                                           ;??????????????
   857 00000469 BB[D5040000]                     mov ebx,message_3                    
   858 0000046E 9A[00000000]2800                 call sys_routine_seg_sel:put_string ;??????ß÷????????????????
   859                                  
   860                                  
   861                                           ;???????????Óï?????????????????????????????????????
   862 00000475 B946000000                       mov ecx,0x46
   863 0000047A 9A[22010000]2800                 call sys_routine_seg_sel:allocate_memory
   864 00000481 E8D2FEFFFF                       call append_to_tcb_link            ;??????????????TCB???? 
   865                                  
   866                                           ;????????? 
   867 00000486 6A32                             push dword 50                      ;???????¶À?????50????
   868 00000488 51                               push ecx                           ;???????????????????? 
   869                                         
   870 00000489 E8B6FBFFFF                       call load_relocate_program
   871                                        
   872 0000048E BB[F1040000]                     mov ebx,do_status
   873 00000493 9A[00000000]2800                 call sys_routine_seg_sel:put_string
   874                                        
   875 0000049A B808000000                       mov eax,mem_0_4_gb_seg_sel
   876 0000049F 8ED8                             mov ds,eax
   877                                        
   878 000004A1 0F005918                         ltr [ecx+0x18]                     ;???????????? 
   879 000004A5 0F005110                         lldt [ecx+0x10]                    ;????LDT
   880                                        
   881 000004A9 8B4144                           mov eax,[ecx+0x44]
   882 000004AC 8ED8                             mov ds,eax                         ;?ß›??????????????? 
   883                                  
   884                                           ;?????????????????????????????????? 
   885 000004AE FF3508000000                     push dword [0x08]                  ;????????????????
   886 000004B4 6A00                             push dword 0                       ;???????esp
   887                                  
   888 000004B6 FF3514000000                     push dword [0x14]                  ;???????????????? 
   889 000004BC FF3510000000                     push dword [0x10]                  ;???????eip
   890                                        
   891 000004C2 CB                               retf
   892                                  
   893                                  return_point:                               ;?????????
   894 000004C3 B830000000                       mov eax,core_data_seg_sel          ;???c14.asm????JMP???????? 
   895 000004C8 8ED8                             mov ds,eax                         ;????@TerminateProgram??????? 
   896                                                                              ;???????????3?????????? 
   897 000004CA BB[F9040000]                     mov ebx, message_6
   898 000004CF 9A[00000000]2800                 call sys_routine_seg_sel:put_string
   899                                  
   900 000004D6 F4                               hlt
   901                                  
   902                                  
   903                                  
   904                                  
   905                                  core_code_end:
   906                                  
   907                                  ;===============================================================================
   908                                  SECTION test_code_ring3 vstart=0
   909                                  ;-------------------------------------------------------------------------------
   910 00000000 B820000000                     mov eax,32
   911 00000005 B820000000                     mov eax,32
   912 0000000A B820000000                     mov eax,32
   913 0000000F B820000000                     mov eax,32
   914 00000014 B820000000                     mov eax,32
   915 00000019 B820000000                     mov eax,32
   916 0000001E B820000000                     mov eax,32
   917 00000023 B820000000                     mov eax,32
   918 00000028 B820000000                     mov eax,32
   919                                  
   920                                  test_code_ring3_end:
   921                                  
   922                                  ;-------------------------------------------------------------------------------
   923                                  SECTION core_trail
   924                                  ;-------------------------------------------------------------------------------
   925                                  core_end:
